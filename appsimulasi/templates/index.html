{% extends "core/base.html" %}
{% block extrahead %}
{% include "alat/asml.html" %}
{% endblock %}
{% block section %}Simulasi{% endblock %}
{% block content %}
{% load number_format %}
<div id="jCrumbs" class="breadCrumb module">
    <ul>
        <li>
            <a href="/"><i class="icon-home"></i></a>
        </li>
        <li>
            Simulasi
        </li>
    </ul>
</div>
<div class="row-fluid">
    <div class="span4">
        <h3 class="heading">Simulasi Kredit CISO</h3>
        <form class="tabular">   
        <div class="row-fluid">
    	   {{form.kode_inst}}   
        </div>
	<div><label>Bank Pendana</label>{{form.kode_bank}}</div>
        <div class="row-fluid">
    	   {{form.tglinput}}&nbsp;
    	   <input type="text" class="input-small ttip_r mask" style="text-align: center" name="usia" id="tgllahir" title="Langkah Kedua" onchange="" onblur="masker(this.value,this,'2,5','-');cekusia_baru(this.value)" placeholder="DD-MM-YYYY"/>
        </div>
        <div class="row-fluid">
    	    {{form.thnusia}}&nbsp;{{form.blnusia}}&nbsp;{{form.hariusia}}
        </div>
                {{form.min_usia}}&nbsp;{{form.max_usia}}
        <div class ="row-fluid"> <label>Status_pensiun</label>{{form.status_pensiun}}</div>
        <div class ="row-fluid"> <label>Jenis Pengajuan</label> {{form.jenis_pengajuan}}</div>
        
    </div>
    <div class="span4">
        <h3 class="heading">Produk</h3>
        <div class="row-fluid"> <label>Produk</label>
            {{form.produk}}&nbsp;{{form.id_param}}
        </div>
    	<div class="row-fluid">
    		<label>DSR</label> {{form.pers_max}} 
    	</div>

    	<div class="row-fluid">
    		{{form.gajibersih}}{{form.angs_max}}
    	</div>
        <div class ="row-fluid"> <label>Mutasi</label> {{form.mutasi}}</div>

    </div>
    <div class="span4">
        <h3 class="heading">Hitungan</h3>
        <div class="row-fluid">
           {{form.tenormaks}} Bulan
        </div>
        <div class="row-fluid">
            <input type="text" class="input-small ttip_r" style="text-align: right" name="jangka_bulan" id="tenor" onkeyup="kosongkan()" onchange="kosongkan()" onblur="validasi_tenor();maks_plafond();" placeholder="tenor pengajuan" title="Langkah Ke Delapan"/> bulan
        </div>
        <div class="row-fluid">
            {{form.plafonmax}}
        </div>
        <div class="row-fluid"><input type="text" name="flat_bln" id="flat_bln" class="required input-mini" style="text-align: right; display:none;" readonly="True"/>
        </div>

        <div class="row-fluid">
            {{form.plafonusul}}
        </div>
        <div class="row-fluid">
                {{form.retensi}}&nbsp;{{form.n_retensi}}
        </div>

       </div>
        <div class="span4"> 
           <div class="form-actions">
              <button class="btn btn-inverse tablular" type="button" onclick="cek_ulang_kredit()"><i class="icon-white icon-ok-circle"></i>
            Hitung</button>
            <button class="btn"><a href="/">Cancel</a></button>
           </div>         
        </div>

    </div>
</div>

<div class="modal fade" id="mymodal">
    <div class="modal-dialog">
      <div class="modal-content">

      </div>
    </div>
</div>

<script>
function ceknilai(elem)
{
    $('#'+elem).keydown(function(event) {
    if (event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 27 || event.keyCode == 190 ||  
                 // Allow: Ctrl+A
                (event.keyCode == 65 && event.ctrlKey === true) || 
                 // Allow: home, end, left, right
                (event.keyCode >= 35 && event.keyCode <= 39) || event.keyCode==13) {
                     // let it happen, don't do anything
                     return;
            }
            else {
                // Ensure that it is a number and stop the keypress
                if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
                    event.preventDefault();
                    $('#'+elem).val(''); 
                }   
    };
    });
}
	
function cek_usia_form()
{
    var usia = $('#thnusia').val();
    var bulan = $('#blnusia').val();
    var hari = $('#hariusia').val();
    var tglinput = $('#tglinput').val();
    var produk = $('#produk').val();
    var sts_pens= $('#id_status_pensiun').val();
    var j_aju =$('#id_jenis_pengajuan').val();
    var kode_inst = $('#kode_inst').val();
    var kode_bank = $('#id_kode_bank').val()	
    var dataString = 'usia='+usia+'&produk='+produk+'&bulan='+bulan+'&hari='+hari+'&tglinput='+tglinput+'&kode_inst='+kode_inst+'&sts_pens='+sts_pens+'&j_aju='+j_aju+'&kode_bank='+kode_bank;
    $.ajax({
        url: "/cek_usia/",
        data: dataString,        
        dataType: "JSON",        
        success: function(data){            
	if(data.result=='1'){
	     if(data.tenor_maks <= '0'){
	         jAlert('Kriteria usia tidak memasuki persyaratan untuk produk ini!')                     
                 tenor_kosong()
                 $('#produk').val('')
                 return false;
	     }else{
                 $('#tenormaks').val(data.tenor_maks);
                 $('#pers_max').val(data.dsr);
                 $('#id_param').val(data.id_param);
                 maks_angsuran()     
	     }                                
	}else{
	     jAlert('Perhatian:  Anda Memilih Produk Yang Salah !!!!')
                $('#produk').val('')
                tenor_kosong();
		return false;
		}
        }
    });   
}

function validasi_tenor()
{

    var tenormaks = parseFloat(to_number($("#tenormaks").val()))
    tahun =$('#tenor').val();
    
    if(tahun > tenormaks )
    {
        jAlert('Tenor Pengajuan Melebihi Tenor Maksimal');
        $('#tenor').val('');
        $('#tenor').focus();
    }
}

function cek_usul()
{

    var maksplafon = parseFloat(to_number($("#plafonmax").val()))
    var usul = parseFloat(to_number($("#plafonusul").val()))
    
    if(usul > maksplafon )
    {
        jAlert('Plafon Melebihi');
        $('#plafonusul').val('');
        $('#plafonusul').focus();
    }
}


function h_mutasi()
{
    var param = $('#id_param').val();
    var tenor = $('#tenor').val();
    var plafond = parseFloat(to_number($("#plafonusul").val()));
    var mutasi = $('#id_mutasi').val();

    var dataString ='param='+param+'&tenor='+tenor+'&plafond='+plafond+'&mutasi='+mutasi;
    $.ajax({
        url: "/hitung_mutasi/",
        data: dataString,        
        dataType: "JSON",        
        success: function(data){      
        if(data.result=='2'){
            $('#id_retensi').val(data.retensi);
            $('#id_n_retensi').val(format_number(String(Math.round(data.n_retensi))));
        }else{
            $('#id_retensi').val('');
            $('#id_n_retensi').val(format_number(String(Math.round(data.n_retensi))));
        }
        }
    });   

}

function validasi_retensi(){
    var mutasi = $('#id_mutasi').val();
    var retensi = $('#id_retensi').val();
    var param = $('#id_param').val();
    var tenor = $('#tenor').val();
    var plafond = parseFloat(to_number($("#plafonusul").val()));
    var dataString ='param='+param+'&tenor='+tenor+'&plafond='+plafond+'&mutasi='+mutasi+'&retensi='+retensi;    
    $.ajax({
        url: "/val_retensi/",
        data: dataString,
        dataType: "JSON",
        success: function(data){
        if(data.result == '1'){
            $('#id_n_retensi').val(format_number(String(Math.round(data.n_retensi))));

        }if(data.result == '2'){
            jAlert('Retensi Tidak Bisa 1 Kali Karna Mutasi');
            $('#id_retensi').val('2');
        }else{
            $('#id_n_retensi').val(format_number(String(Math.round(data.n_retensi))));

       }
    }
});
}


function maks_plafond()
{
    var gaji = parseFloat(to_number($("#gajibersih").val()));
    var usia = $('#thnusia').val();
    var produk = $('#produk').val();
    var kode_inst = $('#kode_inst').val();
    var sts_pens= $('#id_status_pensiun').val();
    var j_aju =$('#id_jenis_pengajuan').val();
    var tenor = $('#tenor').val();

    var dataString ='usia='+usia+'&produk='+produk+'&kode_inst='+kode_inst+'&sts_pens='+sts_pens+'&j_aju='+j_aju+'&gaji='+gaji+'&tenor='+tenor;
    $.ajax({
        url: "/maks_plafond/",
        data: dataString,        
        dataType: "JSON",        
        success: function(data){            
	    $('#plafonmax').val(format_number(String(Math.round(data.plafond))));
            $('#flat_bln').val(data.flatbulan);
            $('#flat').val(data.flattahun);
            $('#effektif').val(data.effektif);
            //tenor_kosong();
        }
    });   
    
}


function cek_ulang_kredit()
{
    var usia = $('#thnusia').val();
    var bulan = $('#blnusia').val();
    var hari = $('#hariusia').val();
    var tgl_pengajuan = $('#tglinput').val();
    var sts_pens= $('#id_status_pensiun').val();
    var j_aju =$('#id_jenis_pengajuan').val();        
    var produk = $('#produk').val();
    var kantor_bayar = $('#kode_inst').val();    
    var gaji = $('#gajibersih').val();
    var tenor = parseFloat(to_number($('#tenor').val()));
    var plafond = parseFloat(to_number($('#plafonusul').val()));
    var retensi = parseFloat(to_number($("#id_n_retensi").val())); 
    var param =$('#id_param').val()
    var mutasi =$('#id_mutasi').val()
    var flatbln =$('#flat_bln').val()
    var tgllahir = $('#tgllahir').val()
    var dataString = 'gaji='+gaji+'&produk='+produk+'&kantor_bayar='+kantor_bayar+'&tenor='+tenor+'&usia='+usia+'&bulan='+bulan+'&hari='+hari+'&plafond='+plafond+'&tgl_pengajuan='+tgl_pengajuan+'&sts_pens='+sts_pens+'&j_aju='+j_aju+'&param='+param+'&flatbln='+flatbln+'&tgllahir='+tgllahir+'&retensi='+retensi+'&mutasi='+mutasi;
    $.ajax({
        url: "/show_simulasi/",
        data: dataString,        
        dataType: "JSON",       
        beforeSend: function () {
             $("#mymodal .modal-content").html("");
             $("#mymodal").modal("show");
        },
        success: function (data) {
            $("#mymodal .modal-content").html(data.django_form);
        } 
    });   
}


function choose_kri()
{
    $('#tenor').val('');
    $('#plafonusul').val('');
    $('#plafonmax').val('0');
}
function kosong()
{
	$('#jenis').val('');
}
function id_kos()
{
    $('#id_param').val('');
    $('#pers_max').val('');
    $('#tenormaks').val('')
}

function id_dkos()
{
    $('#id_param').val('');
    $('#pers_max').val('');
    $('#tenormaks').val('');
    $('#produk').val('');
   
}
function tenor_kosong()
{
    $('#tenor').val('');
    $('#plafonusul').val('');
    $('#angsuran').val('');
}
function kosongkan()
{
    $('#id_plafonmax').val('');
    $('#id_effektif').val('');
    $('#id_flat').val('');
    $('#plafonusul').val('0');
    $('#plafonmax').val('0');
}
</script>



{%endblock%}

